# 动态开点，单点修改，区间查询，权值线段树
```cpp
const int N=1e5+3;
struct SegmentTree
{
    int tot;
    struct node
    {
        int l,r,sum;
    }st[N<<2];
    void update(int &id, int l, int r,int val)
    {
        if(!id)
            id=++tot;
        ++st[id].sum;
        if(l==r)
            return;
        int mid = (l+r)/2;
        if (val <= mid)
            update(st[id].l,l,mid,val);
        else
            update(st[id].r,mid+1,r,val);
    }
    int query(int id,int segl,int segr,int l, int r)
    {
        if (l <= segl && segr <= r)
            return st[id].sum;
        int mid = (segl + segr)/2,res=0;
        if (l <= mid)
            res+=query(st[id].l,segl,mid,l,r);
        if (r > mid)
            res+=query(st[id].r,mid+1,segr,l,r);
        return res;
    }
    void init()
    {
        for(;tot;--tot)
            st[tot]={0,0,0};
    }
}st;
st.init();
st.update(1,MinVal,MaxVal,val);
st.query(1,MinVal,MaxVal,l,r);
```