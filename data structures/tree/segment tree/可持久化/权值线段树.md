#! https://zhuanlan.zhihu.com/p/557877952
# 单点修改
```c++
const int N=1e5+3;
struct persistentWeightSegmentTree
{
    int tot,q;
    int rt[N];
    struct node
    {
        int l,r,sum;
    }st[N<<5];
    void init(int n)//原数组a（从1开始），离散数组C
    {
        tot=0;
        memcpy(C+1,a+1,sizeof(a[0])*(n));
        sort(C+1,C+n+1);
        q=unique(C+1,C+n+1)-C-1;
        for(int i=1;i<=n;++i)
            modify(rt[i],rt[i-1],1,q,lower_bound(C+1,C+q+1,a[i])-C);
    }
    void modify(int &id,int pre,int l,int r,int pos)
    {
        id=++tot;
        st[id]=st[pre];
        ++st[id].sum;
        if(l==r)
            return;
        int mid=(l+r)/2;
        if(pos<=mid)
            modify(st[id].l,st[id].l,l,mid,pos);
        else
            modify(st[id].r,st[id].r,mid+1,r,pos);
    }
    int query(int u,int v,int l,int r,int k)//查询区间[u,v]的第k小值的下标
    {
        if(l==r)
            return l;
        int mid=(l+r)/2,x=st[st[v].l].sum-st[st[u].l].sum;
        if(x>=k)
            return query(st[u].l,st[v].l,l,mid,k);
        return query(st[u].r,st[v].r,mid+1,r,k-x);
    }
    int ask(int l,int r,int k)
    {
        return C[query(rt[l-1],rt[r],1,q,k)];
    }
}wt;
wt.init(n);
wt.ask(l,r,k);
```