>这类题目是把看起来只能暴力算的式子化成数论分块可以算出来的东西  
>难度主要是推式子，式子不唯一，只要复杂度够低就行  
>卷积和莫反一般通用，但是有些题目有些解法更好用  
>有的题目甚至殊途同归   
>有空的话就一道题用两种方法
## 形式1：$\sum\limits_{i=1}^n \sum\limits_{j=1}^m [gcd(i,j)=1]$

### 方法1（迪利克雷卷积）
值只有1和0的式子考虑用单位函数替代

原式 $=\sum\limits_{i=1}^n \sum\limits_{j=1}^m ε(gcd(i,j))$

根据 $μ*1=ε$ 

原式 $=\sum\limits_{i=1}^n \sum\limits_{j=1}^m \sum\limits_{d\mid gcd(i,j)} μ(d)$

枚举gcd

原式 $=\sum\limits_{d=1}^{\min(n,m)} μ(d)\lfloor\frac nd\rfloor\lfloor\frac md\rfloor$

最后这个式子可以数论分块算

### 方法2（莫比乌斯反演）
设 $F(n,m,d)=\sum\limits_{i=1}^n \sum\limits_{j=1}^m [d\mid gcd(i,j)]$

$i,j$枚举$d$的倍数，得 $F(n,m,d)=\lfloor\frac nd\rfloor * \lfloor\frac md\rfloor$

设 $f(n,m,d)=\sum\limits_{i=1}^n \sum\limits_{j=1}^m [gcd(i,j)=d]$

显然 $F(n,m,d)=\sum\limits_{d\mid D}^{\min(n,m)} f(n,m,D)$

套用倍数形式莫比乌斯反演公式，得

$f(n,m,d)=\sum\limits_{d\mid D}^{\min(n,m)} F(n,m,D)*μ(D/d)=\sum\limits_{d\mid D}^{\min(n,m)} \lfloor\frac nD\rfloor  \lfloor\frac mD\rfloor*μ(D/d)$

最后这个式子可以数论分块算

---
变形：$\sum\limits_{i=1}^n \sum\limits_{j=1}^m [gcd(i,j)=k]$

卷积 $i,j$枚举$k$的倍数，注意改变求和上限

原式 $=\sum\limits_{i=1}^{\lfloor\frac nk \rfloor} \sum\limits_{j=1}^{\lfloor\frac mk \rfloor} ε(gcd(i,j))=\sum\limits_{d=1}^{\min(\lfloor\frac nk\rfloor,\lfloor\frac mk\rfloor)} μ(d)\lfloor\frac n{kd}\rfloor\lfloor\frac m{kd}\rfloor$

或者莫反

---

变形：求 $\sum\limits_{i=a}^n \sum\limits_{j=b}^m [gcd(i,j)=k]$

容斥原理即可，类似二维前缀和

---
变形：求 $\sum\limits_{p∈prime}\sum\limits_{i=1}^n \sum\limits_{j=1}^m [gcd(i,j)=p]$

卷积做法：

原式 $=\sum\limits_{p∈prime}\sum\limits_{d=1}^{\min(\lfloor\frac np\rfloor,\lfloor\frac mp\rfloor)} μ(d)\lfloor\frac n{pd}\rfloor\lfloor\frac m{pd}\rfloor$

设 $T=pd$，

原式 $=\sum\limits_{p∈prime}\sum\limits_{d=1}^{\min(\lfloor\frac np\rfloor,\lfloor\frac mp\rfloor)} μ(T/p)\lfloor\frac n{T}\rfloor\lfloor\frac m{T}\rfloor$

枚举 $T$

原式 $=\sum\limits_{T=1}^{\min(n,m)}\sum\limits_{p∈prime,p\mid T} μ(T/p)\lfloor\frac n{T}\rfloor\lfloor\frac m{T}\rfloor$

设 $f(x)=\sum\limits_{p∈prime,p\mid x} μ(x/p)$

可以线性筛处理出 $f(x)$，思考方向类似线性筛处理欧拉函数

$f(x=i*p)=\begin{cases}1&x∈prime\\μ(i)&i\mod p=0\\μ(i)-f(i)&i\mod p\neq 0\end{cases}$

处理 $f(x)$的前缀和，就可以数论分块了

莫反做法：

令 $f(x)=[x∈prime]$，找到一个 $g$，使得 $f=1*g$

那么 $g=f*\mu=\sum\limits_{d\mid x} \mu(x/d)[d∈prime]$

$=\sum\limits_{p\mid x} \mu(x/p)$

这个函数可以埃氏筛筛出$O(n\log\log n)$
```c++
for (int j = 0; j < prime_count; j++)
{
    for (int p = prime[j], i = 1; i * p <= N; i++)
        g[i * p] += mu[i];
}
```
原式$=\sum\limits_{i=1}^n\sum\limits_{j=1}^m f(gcd(i,j))$

$=\sum\limits_{i=1}^n\sum\limits_{j=1}^m \sum\limits_{d\mid gcd(i,j)} g(d)$

$=\sum\limits_{d=1}^{min(n,m)} g(d)\lfloor\frac nd\rfloor\lfloor\frac md\rfloor$

---
## 形式2：$\sum\limits_{i=1}^n \sum\limits_{j=1}^m gcd(i,j)$

卷积处理，留作思考

参考答案 $=\sum\limits_{d=1}^{\min(n,m)} φ(d) \lfloor\frac nd \rfloor\lfloor\frac md \rfloor$

---

变形：求 $\sum\limits_{i=1}^n \sum\limits_{j=1}^m ij\times gcd(i,j)$

卷积处理，留作思考

参考答案 $=\sum\limits_{d=1}^{\min(n,m)} φ(d)*d^2*g(\lfloor\frac nd\rfloor)*g(\lfloor\frac md\rfloor)$

$g(x)=(1+x)*x/2$

---

变形：$\sum\limits_{i=1}^n \sum\limits_{j=1}^m lcm(i,j)$

卷积处理，留作思考，很好的练习题

参考答案 $=\sum\limits_{d=1}^{min(n,m)} d*sum(\lfloor\frac nd\rfloor,\lfloor\frac md\rfloor)$

$sum(n,m)=\sum\limits_{d=1}^{min(n,m)} μ(d)*d^2*g(\lfloor\frac nd\rfloor,\lfloor\frac md\rfloor)$

$g(n,m)=[(n+1)n/2]*[(m+1)*m/2]$

---

求 $\sum\limits_{i=1}^n \sum\limits_{j=1}^m σ_0(ij)$

先自行尝试把常用数论函数里给出的性质化成下面那个式子

再带回本题

原式 $=\sum\limits_{i=1}^n\sum\limits_{j=1}^m\sum\limits_{p \mid \gcd(i,j)}\mu(p)σ_0\left(\frac{i}{p}\right)σ_0\left(\frac{j}{p}\right)$

枚举 $p$

$=\sum\limits_{p=1}^{min(n,m)} \sum\limits_{i=1}^n\sum\limits_{j=1}^m [p \mid \gcd(i,j)]\cdot\mu(p)σ_0\left(\frac{i}{p}\right)σ_0\left(\frac{j}{p}\right)$

$i,j$ 枚举 $p$ 的倍数

$=\sum\limits_{p=1}^{min(n,m)} \sum\limits_{i=1}^{\left\lfloor\frac{n}{p}\right\rfloor}\sum\limits_{j=1}^{\left\lfloor\frac{m}{p}\right\rfloor} \mu(p)σ_0(i)σ_0(j)$

$μ(p)$ 和 $i,j$ 无关，提到前面去，$σ_0(i)$ 同理

$=\sum\limits_{p=1}^{min(n,m)}\mu(p) \sum\limits_{i=1}^{\left\lfloor\frac{n}{p}\right\rfloor}σ_0(i) \sum\limits_{j=1}^{\left\lfloor\frac{m}{p}\right\rfloor}σ_0(j)$

简化形式

$=\sum\limits_{p=1}^{min(n,m)}\mu(p)*S\left(\left\lfloor\frac{n}{p}\right\rfloor\right)*S\left(\left\lfloor\frac{m}{p}\right\rfloor\right)$

$S(n)=\sum\limits_{i=1}^{n} σ_0(i)$

$σ_0(n)$ 可以线性筛处理，线性筛.md里有讲

---

## 形式3：$\sum\limits_{i=1}^n\sum\limits_{j=1}^m f(gcd(i,j))$

### 卷积做法
枚举gcd

$\sum\limits_{d=1}^{min(n,m)} f(d) \sum\limits_{i=1}^n\sum\limits_{j=1}^m [gcd(i,j)=d]$

枚举d的倍数

$\sum\limits_{d=1}^{min(n,m)} f(d) \sum\limits_{i=1}^{\lfloor\frac nd\rfloor}\sum\limits_{j=1}^{\lfloor\frac md\rfloor} [gcd(i,j)]$

$\mu * 1=\epsilon$

$\sum\limits_{d=1}^{min(n,m)} f(d) \sum\limits_{i=1}^{\lfloor\frac nd\rfloor}\sum\limits_{j=1}^{\lfloor\frac md\rfloor} \sum\limits_{t\mid gcd(i,j)}\mu(t)$

枚举 t

$\sum\limits_{d=1}^{min(n,m)} f(d) \sum\limits_{t=1}^{min(\lfloor\frac nd\rfloor,\lfloor\frac md\rfloor)} \mu(t)\sum\limits_{i=1}^{\lfloor\frac nd\rfloor}\sum\limits_{j=1}^{\lfloor\frac md\rfloor} [t\mid gcd(i,j)]$

枚举t的倍数

$\sum\limits_{d=1}^{min(n,m)} f(d) \sum\limits_{t=1}^{min(\lfloor\frac nd\rfloor,\lfloor\frac md\rfloor)} \mu(t)\sum\limits_{i=1}^{\lfloor\frac n{dt}\rfloor}\sum\limits_{j=1}^{\lfloor\frac m{dt}\rfloor} 1$

$\sum\limits_{d=1}^{min(n,m)} f(d) \sum\limits_{t=1}^{min(\lfloor\frac nd\rfloor,\lfloor\frac md\rfloor)} \mu(t)\lfloor\frac n{dt}\rfloor\lfloor\frac m{dt}\rfloor$

设 $T=dt$

$\sum\limits_{T=1}^{min(n,m)} \lfloor\frac nT\rfloor\lfloor\frac mT\rfloor \sum\limits_{d\mid T} f(d)\mu(T/d)$

### 莫反做法

设题目中f为 $f$，找到 $g$，满足 $f=1*g$

那么 $g=\mu*f$,筛出 $g$,之后做法和形式1最后一题类似

```c++
void get_g(int N, const int *f, int *g)
{
    for (int i = 1; i <= N; i++)
        g[i] = f[i];
    for (int i = 0; i < prime_count; i++)
    {
        for (int j = N / prime[i]; j >= 1; j--)
            g[j*prime[i]]=(g[j*prime[i]]-g[j])%mod;
    }
}//O(nloglogn)
```
可以理解成 DP:
$$g_{i,n}=\sum\limits_{d\mid n,d只含前i种质因子} \mu(d)f(n/d)$$
具体转移就是
$$g_{i,n}=\begin{cases}g_{i-1,n}&p_i\nmid n\\ g_{i-1,n}-g_{i-1,n/p_i}&p_i\mid n\end{cases}$$