#! https://zhuanlan.zhihu.com/p/557826846
数论主要研究整数的整除问题

# 整除性

整数$a$和$b$，$a$整除$b$指$b$是$a$的倍数，$a$是$b$的约数（因数、因子），记为$a\mid b$。

## 整除性质

1.  任意性，若$a\mid b$，则对于任意非零整数$m$，有$am\mid bm$

2.  传递性，若$a\mid b$，且$b\mid c$，则$a\mid c$

3.  可消性，若$a\mid bc$，且$a$和$c$互素(互素的概念下文会讲到)，则$a\mid b$

4.  组合性，若$c\mid a$，且$c\mid b$，则对于任意整数$m$、$n$，有$c\mid (ma+nb)$。

### 例题

$x$，$y$，$z$均为整数，若$11\mid (7x+2y-5z)$，求证：$11\mid(3x-7y+12z)$

令$a = (7x+2y-5z)$，$b = (3x-7y+12z)$

构造得 $4a + 3b = 11(3x-2y+3z)$

则$3b = 11(3x-2y+3z) - 4a$

因为$11\mid a$，$11\mid 11(3x-2y+3z)$

组合性得 $11 \mid(11(3x-2y+3z) - 4a)= 11\mid 3b$

可消性，由于$11$和$3$互素，得出 $11 \mid b$，证明完毕

# 素数

## 素数与合数

素数（又称质数）

大于等于$2$，并且除了$1$和它本身外，不能被其它任何自然数整除；

其它的数称为合数；

注意：$1$既非素数也非合数。

## 素数判定

如何判定一个数是否为素数？

1. 对$n$做$[2, n)$范围内的余数判定(C/C++中的$\%$运算符),

如果有至少一个数用$n$取余后为$0$,则表明$n$为合数,否则$n$为素数，

时间复杂度$O(n)$。

2. 假设一个数能整除$n$，即$a\mid n$，那么$n/a$也必定能整除$n$

不妨设$a \le n/a$，则有$a^2 \le n$，即$a \le \sqrt n$

所以在用 方法 1 的方法进行取余的时候，范围可以缩小到$\sqrt n$，

所以时间复杂度降为$O( \sqrt n )$

3. 如果$n$是合数，那么它必然有一个小于等于$\sqrt n$的素因子，

只需要对$\sqrt n$内的素数进行测试即可，
需要预处理求出$\sqrt n$中的素数，

假设该范围内素数的个数为$s$，那么复杂度降为$O(s)$。

4. 大数判素

前置知识：二次剩余，费马小定理  
据杜老师所说只要留板子  
该算法原理和以上算法原理不同，[原理](https://zhuanlan.zhihu.com/p/220203643)

## 素数分布定理

当$x$很大时，小于$x$的素数的个数近似等于$x/ln(x)$

## 素数筛选法

查找出范围内所有素数，并标记范围内所有数是否素数  
埃氏筛的思想是素数的倍数一定不是素数，所以每找到一个素数，就把它的倍数标记  
如果前面没标记当前数是合数，那么这个数就是素数  
埃氏筛的缺陷是会重复筛一些数，比如$20=2*10=5*4$  
线性筛在埃氏筛上更进一步，让每个合数只被它的最小质因子筛选一次，减少了重复  
单纯筛素数用线性筛  
埃氏筛常用来计算贡献，筛卷积函数等

例如[洛谷 p3601](https://www.luogu.com.cn/problem/P3601)

> 贡献：某个变量对答案的增益

# 因数分解

## 算术基本定理

每个整数$n$，都可以唯一分解成素数的乘积，即
$n=\prod\limits_{i=1}^sp_i^{k_i}
$  
这里$p_i$是各不相同的素数，$k_i$是指数

## 质因数分解

给定一个数$n$，如何将它拆分成素数的乘积呢？  
还是用到上面讲到的试除法，  
然后通过枚举$[2, \sqrt n]$的素数，如果能够找到一个素数$p$，使得$n \% p = 0$  
于是$m = n/p$，这时还需要注意一点，因为$m$中可能也有$p$这个素因子，  
所以如果$p\mid m$，需要继续试除，
直到将所有的素因子$p$除尽，统计除的次数$e$，  
于是我们得到了 $n = p^e * n'$，然后继续枚举素数对$n'$做同样的试除。  
枚举完$[2, \sqrt n]$的素数后，这时有两种情况：

1. $S == 1$，则素数分解完毕；
2. $S > 1$, 根据算术基本定理，$S$ 必定为素数，  
   而且是大于$\sqrt n$的素数，并且最多只有$1$个，  
   这种情况同样适用于 n 本身就是素数的情况，这时$n = S$  
   这样的分解方式称为因数分解。  
   算法时间复杂度为$O( s )$，$s$为$\sqrt n$内素数的个数。  
   请自行在不看资料的情况下实现，如果不能，说明没有理解

## 求所有因数

分解质因数，所有因数可以通过质因数相乘得出，  
例如$24=2^3*3^1$,$24$的因子有$1,2,3,4,6,8,12,24$  
$A=\{2^0,2^1,2^2,2^3\}$  
$B=\{3^0,3^1\}$  
$2^0*3^0=1,2^1*3^0=2,2^2*3^0=4,2^3*^0=8$  
$2^0*3^1=3,2^1*3^1=6,2^2*3^1=12,2^3*^1=24$  
这样就不遗漏不重复的求出了所有因数，而且可以扩展到更多个质因数的情况  
原理是算术基本定理，“唯一性”  
请自行在不看资料的情况下实现，如果不能，说明没有理解

## 因子个数（非人均）

1. 分解质因数

每个质因数可以取的个数为$[0,k_i]$,n 的因子个数就是$\prod\limits_{i=1}^s (1+k_i)
$

时间复杂度为$O( s )$

2.  线性筛筛选

前置知识：积性函数

原理不难，暂时没遇到改变算法内部结构的题，可以当黑盒用  
[原理博客](https://blog.csdn.net/controlbear/article/details/77527115)

## 因子和（非人均）

1. 把求所有因数小节下的$A,B$改写成

$A=\{a,b,c,d\}$

$B=\{e,f\}$

因子和就是

$a*e+b*e+c*e+d*e+a*f+b*f+c*f+d*f$

$=(a+b+c+d)*e+(a+b+c+d)*f$

$=(a+b+c+d)*(e+f)$

所以得到因子和

$=\prod\limits_{i=1}^s \sum\limits_{j=0}^{k_i} p_i^j 
$

$=\prod\limits_{i=1}^s \frac{p_i^{k_i+1}-1}{p_i-1}
$

也可以不写成上式，用倍增加速

设$f(p,k)=
\begin{cases}1 &k=0
\\f(p,k-1) + p^k & k\%2=0
\\(1+p^{(k+1)/2}*f(p,k/2) & k\%2=1\end{cases}$

因子和$=\prod\limits_{i=1}^s f(p_i,k_i)$

如果没有学过倍增，这个$f$函数稍难理解

请自行在不看资料的情况下实现倍增写法，如果不能，说明没有理解

线性筛筛选  
前置知识：积性函数  
原理不难，暂时没遇到改变算法内部结构的题，可以当黑盒用  
[原理博客](https://blog.csdn.net/controlbear/article/details/77527115)

# 最大公约数和最小公倍数

两个数$a$和$b$的最大公约数(Greatest Common Divisor)是指

同时整除$a$和$b$的最大因数，记为$gcd(a, b)$

当$gcd(a, b) = 1$，我们称$a$和$b$互素(又称互质)

两个数$a$和$b$的最小公倍数(Leatest Common Multiple)是指

同时被$a$和$b$整除的最小倍数，记为$lcm(a, b)$

$gcd$是基础数论中非常重要的概念，求解$gcd$一般采用欧几里得算法

而求$lcm$通过$lcm(a, b) = ab / gcd(a, b)$求解

## $gcd$性质

$gcd(a,b)=gcd(a-b,b)$

$gcd(a,b)=gcd(a,a-b)$

$gcd(a,b)=gcd(b,a\%b)$

为了求解，人为规定$gcd(a,0)=a$

### 例题

三个未知数$x$,$y$,$z$，它们的$gcd$为$G$,$lcm$为$L$，$G$和$L$已知，求$(x, y, z)$三元组的个数。

首先要做的就是将$G$和$L$分别进行素因子分解，

然后遍历$L$的每个素因子，对于每个素因子单独处理。

假设素因子为$p$，$L$分解式中$p$的指数为$l$，$G$分解式中$p$的指数为$g$，

那么显然$l < g$时不可能存在满足条件的三元组，

所以只需要讨论$l \ge g$的情况，

对于单个$p$因子，问题转化成了求三个数$x_i, y_i, z_i$，

满足$min\{x_i, y_i, z_i\} = g$且$max\{x_i, y_i, z_i\} = l$，

这是一个排列组合问题，三元组$\{x_i, y_i, z_i\}$的种类数当$l = g$时只有$1$种，否则答案就是 $6(l - g)$

最后根据乘法原理将每个素因子对应的种类数相乘就是最后的答案

# 欧拉函数

一个重要的函数，表示小于$n$且与$n$互素的正整数的个数

符号为$φ(n)$，希腊字母$phi$

性质 $1$：质数$p$，$φ(p^n)=(p-1)*p^{n-1}$

性质 $2$：$a\mid x$，$φ(ax)=a*φ(x)$

性质 $3$：$gcd(a,b)=1$，$φ(a)*φ(b)=φ(ab)$

拓展：小于等于$n$且与$n$互素的正整数的和

$\sum\limits_{i=1}^{n} i*(gcd(i,n)==1)=n*φ(n)/2$

特例：$n=1,result=1$

证明：

因为$gcd(i,n)=gcd(n-i,n)$

所以每个和 $n$ 互质的数都有一个互补的数，和 $n$ 互质的数总共有 $φ(n)$ 个，所以总和为 $n*φ(n)/2$

---

质因数分解，$x=\prod\limits_{i=1}^sp_i^{k_i}$

根据性质 $1$和性质 $3$，可得

$φ(x)=\prod\limits_{i=1}^s p_i^{k_i-1}*(p_i-1)$

$=x*\prod\limits_{i=1}^s (p_i-1)/p_i$

单次求法见$\color{powderblue}欧拉函数.md$

可以用线性筛求一些积性函数

> 积性函数：数论函数中,若$p$,$q$互质，满足$f(pq)=f(p)*f(q)$,则 f 为积性函数
>
> > 数论函数(又称算术函数):在数论上，指定义域为正整数、陪域为复数的函数
> >
> > > 陪域：在映射$f：X→Y$ 中，X 称为定义域，Y 称为陪域。对于某个映射来说，它的值域一定为陪域的子集

如约数个数，约数和，欧拉，莫比乌斯都是积性函数  
若任意$p$,$q$，满足$f(pq)=f(p)*f(q)$，则 f 为完全积性函数  
如$1$函数，即$f(x)=1$

积性函数性质可知，$f(1)=1$  
欧拉函数筛法见$\color{powderblue}线性筛.md$ $part$ $2$  
欧拉函数与后面许多内容都联系紧密

# 快速幂

严格来说不算数论，但之后知识会用到  
（数论是研究整数的整除问题，不是数学都算数论）  
计算幂，可以用倍增加速  
（这里只是让你初次认识倍增，之后求解 rmq 问题和求解 lca 问题还会碰到倍增）  
倍增就是字面意思，一倍一倍地增长，例如这里是 n/2 到 n,增长了一倍

$a^n=\begin{cases}a^{n-1}*a&n\%2=1
\\1&n=0
\\a^{n/2}*a^{n/2}&n\%2=0\end{cases}
$
也可以用二进制加速  
二进制表示指数  
$5=101,3^5=3^{2^0+2^2}=3^{2^0} * 3^{2^2}$  
通过上式可以发现，只有指数当前位为 1，才对答案有贡献  
通常用二进制加速版快速幂

# 同余

## 模运算

给定一个正整数$p$，任意一个整数$n$，一定存在等式$n = kp + r$；  
其中$k$、$r$是整数，且满足$0 \le r < p$，  
称$k$为$n$除以$p$的商， $r$为$n$除以$p$的余数，记为$n \% p = r$ ($\%$表示取模运算)  
对于正整数和整数$a$, $b$, 定义如下运算：  
取模运算：$a \% p$，表示$a$除以$p$的余数。  
模$p$加法：$(a + b) \% p = (a\%p + b\%p) \% p$  
模$p$减法：$(a - b) \% p = (a\%p - b\%p) \% p$  
模$p$乘法：$(a * b) \% p = ((a \% p) * (b \% p)) \% p$  
模$p$除法：$(a / b) \% p = ((a \% p) * (inv(b) \% p)) \% p$  
$inv()$表示逆元，之后学习  
幂模$p$ ：$(a ^ b) \% p = ((a \% p) ^ b) \% p$  
幂模可以用快速幂加速  
模运算满足结合律、交换律和分配律。  
$a\equiv b \pmod n$ 表示$a$和$b$模$n$同余，即$a$和$b$除以$n$的余数相等。  
$\equiv$ 是恒等于符号，表示绝对成立，无论变量取什么值  
（$=$是条件成立，要求变量满足条件才成立）  
在模运算方程中，通常使用$\equiv$，约定俗成的习惯

### 例题

一个 n 位十进制数(n <= 1e6)必定包含 1、2、3、4 四个数字，现在将它顺序重排，求给出一种方案，使得重排后的数是 7 的倍数。

取出 1、2、3、4 后，将剩下的数字随便排列得到一个数 a，  
令取出的四个数字排列出来的数为 b，那么就是要找到一种方案使得$(10000a + b) \% 7$等于 0。

也就是说如果无论 a 等于多少，都能找到这样的 b 满足等式成立，那么 a 就可以随便排。

我们将等式简化：  
$(10000a + b) \% 7 = (10000\%7*a + b\%7) \% 7$  
令 $k = a*10000\%7 = a*4\%7$，容易发现 k 的取值为[0, 7)，  
如果 b%7 的取值也是[0, 7)，
那这个问题就可以完美解决了，  
很幸运的是，的确可以构造出 7 个这样的 b

# 欧拉定理&费马小定理

# 线性同余方程

线性同余方程（又称模线性方程）

线性指未知数都是一次的方程  
最基本的同余方程，  
即$ax\equiv b \pmod n$，其中$a$、$b$、$n$都为常量，x 是未知数，

这个方程可以进行一定的转化，  
得到：$ax = kn + b$,这里的 k 为任意整数，  
于是我们可以得到更加一般的形式即：$ax + by + c = 0$，  
这个方程就是二维空间中的直线方程，

但是 x 和 y 的取值为整数，所以这个方程的解是一些排列成直线的点集。

可以用拓欧求解

# 逆元

# 线性同余方程组

# 原根

# BSGS

> 下面三个大知识点一起用的，请全部学习后再开始写题

# 狄利克雷卷积&莫比乌斯反演

# 数论分块

# 卷积&莫反例题

> 一个常识：$d\mid i,d\mid j⇔d\mid gcd(i,j)$
