#! https://zhuanlan.zhihu.com/p/571047119
# 二项式反演
解决“多个条件恰好满足几个“这类计数问题。

恰好不好求，因为不仅需要 $i$ 个满足，而且需要 $n−i$ 个不满足
## 形式1
$g(i)$  表示 $n$ 个条件，恰好满足 $i$ 个的情况数，的总和

以 $n=3$ 作图例解释：

![g(1)](/graph%20for%20md/%E4%BA%8C%E9%A1%B9%E5%BC%8F%E5%8F%8D%E6%BC%94%E5%BD%A2%E5%BC%8F1%20g1.png)

上圆表示满足条件1的情况，左下圆表示满足条件2的情况，右下圆表示满足条件3的情况

重叠部分表示同时满足多个条件的情况

恰好只满足条件1的情况是上圆被红线覆盖的部分，恰好只满足条件2的情况是左下圆被红线覆盖的部分，恰好只满足条件3的情况是右下圆被红线覆盖的部分

恰好满足1个条件的情况，的总和，其实就是3部分的和

![g(2)](/graph%20for%20md/%E4%BA%8C%E9%A1%B9%E5%BC%8F%E5%8F%8D%E6%BC%94%E5%BD%A2%E5%BC%8F1%20g2.png)

恰好只满足条件1，2的情况是上圆和左下圆重叠且被红线覆盖的部分；恰好只满足条件1，3的情况是上圆和右下圆重叠且被红线覆盖的部分；恰好只满足条件2，3的情况是左下圆和左下圆重叠且被红线覆盖的部分

恰好满足2个条件的情况，的总和，其实就是3部分的和

![g(3)](/graph%20for%20md/%E4%BA%8C%E9%A1%B9%E5%BC%8F%E5%8F%8D%E6%BC%94%E5%BD%A2%E5%BC%8F1%20g3.png)

恰好只满足条件1，2，3的情况是3圆重叠部分

恰好满足3个条件的情况，的总和，其实就是1部分的和

---
$f(k)$ 表示 $n$ 个条件选择其中 $k$ 个满足，剩下 $n−k$ 个随意的情况数，的总和

满足条件1的情况是上圆，满足条件2的是左下圆，满足条件3的是右下圆

$f(1)=$ 三个圆形面积的和 $=g(1)+2g(2)+3g(3)$

满足条件1，2的情况是上圆和左下圆重叠的部分；满足条件1，3的情况是上圆和右下圆重叠的部分；满足条件2，3的情况是左下圆和左下圆重叠的部分

$f(2)=$ 三个重叠部分面积的和 $g(2)+3g(3)$

满足条件1，2，3的情况是3圆重叠部分

$f(3)=$ 重叠面积 $g(3)$

---
观察发现 $f,g$ 有以下关系，根据g贡献在哪里来理解：

$f(k)=\sum\limits_{i=k}^n \dbinom ik g(i)$

>不能用满足至少k个条件来理解，因为那样理解 $f(1)$ 就是三个圆的并集的面积，而不是三个圆的面积和

---
通常情况是 $f$ 可以DP算出来，然后通过以下公式反演出 $g$



$g(k)=\sum\limits_{i=k}^n (-1)^{i-k}\dbinom ikf(i)$
## 形式2
$g(i)$  表示 $n$ 个条件，恰好满足 $i$ 个的情况数，但不是总和

![g(1)]()

![g(2)]()

![g(3)]()

$f(k)$ 表示选择 $k$ 个满足，剩下 $n−k$ 个随意的情况数，但不是总和

$f(3)=$ 三个圆形面积的并 $=3g(1)+3g(2)+g(3)$

通常情况是 $f$ 可以组合数学或者DP算出来，然后通过以下公式反演出 $g$

$f(k)=\sum\limits_{i=m}^{k} \dbinom ki g(i)$

$g(k)=\sum\limits_{i=m}^k (-1)^{k-i}\dbinom kif(i)$

个人感觉对满足条件个数相同，条件序号选择不同，g(i)相等时用形式2，否则用形式1

比如g(1)选左下还是上面还是右下的数量都一样，那么用形式2